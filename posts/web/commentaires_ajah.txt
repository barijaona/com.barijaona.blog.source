En ce nouvel an, on lave plus blanc...
meta-creation_date: 13/1/2008 00:46:27

C'est encore l'époque des cadeaux, donc qu'est ce qu'on pouvait bien donner en ce nouvel an à des gens situés parfois à l'autre bout de la planète ?

Des souhaits de bonne humeur certes pour les lecteurs les plus fidèles (une bonne année, quoi !), mais des geekeries c'était quand même un peu plus concret...

Donc on s'y est mis, avec prise de tête et tout et tout...

Cela faisait un certain temps que je trouvais les possibilités d'Haloscan un brin primitives et que j'enviais la page d'accueil d'[Embruns](http://embruns.net "Laurent Gloaguen"). Un accès plus direct aux commentaires, cela favorise quand même l'interactivité avec le lecteur...

Et comme Laurent avait testé [de nouveaux joujoux](http://embruns.net/logbook/2007/09/20.html#005661 "Ahah, je ris") (non, je ne me référais pas à certains envois récents par Chronopost...), l'envie de bidouiller m'a repris...

Les contraintes étaient nombreuses et relativement ardues :

* l'hébergement chez mac.com n'offre aucun langage de script coté serveur : ni PHP, ni Ruby, ni Python, ni Perl... Ouin !!!
* le stock de commentaires antérieurs est chez Haloscan, et autant que faire se peut, je ne souhaitais pas changer...
* cela nous amenait presque inévitablement à de la communication entre deux noms de domaines différents, et ça, en règle générale, c'est violemment prohibé par les navigateurs pour des raisons de sécurité...
* tout récemment, Haloscan a avancé sur <a href="http://news.haloscan.com/2008/01/haloscan-introduces-in-line-comments.html" title="Haloscan Introduces In-line Comments" hreflang="en" >l'intégration de commentaires dans d'autres pages</a>, mais cela reste un bien primitif `document.write`, qui génére qui plus est un code HTML rempli de bugs... Pas de JSON, pas d'objet...
* je n'avais pas envie de m'embarquer dans l'apprentissage d'énormes bibliothèques Javascript qui alourdiraient le temps de chargement des pages... La bande passante reste rare et chère par ici, nom d'un chien !
* la compatibilité avec tous les navigateurs, même archaïques, et l'accessibilité devaient être absolument préservées. On a sa fierté, quand même !

La solution est une combinaison d'<a href="http://developer.apple.com/internet/webcontent/iframe.html" title="Remote Scripting with IFRAME" hreflang="en"><code>IFRAME</code></a> et d'<a href="http://jimmyzimmerman.com/blog/2006/08/ajax-vs-ajah.html" title="Jimmy Z : AJAX vs AJAH" hreflang="en">AJAH (<i lang="en"><strong>A</strong>synchronous <strong>J</strong>avaScript <strong>A</strong>nd <strong>H</strong>TML)</i></a> dont je suis raisonnablement fier... La page d'accueil valide et fait sourire iCab, et même sous <a href="http://www.joyoftech.com/joyoftech/joyarchives/1052.html" title="The Joy Of Tech" hreflang="en">Internet Explorer 5 pour Macintosh</a>, la mise à jour dynamique fonctionne...

Quant aux navigateurs encore plus anciens ou ayant désactivé Javascript, ils continuent d'accéder aux commentaires par un lien classique...

Bien entendu, je compte sur mes lecteurs pour vérifier que tout fonctionne bien.  Je n'ai notamment pas d'Internet Explorer sous Windows sous la main... Quant aux plus geeks d'entre vous, ils pourront examiner le code mis en oeuvre.
